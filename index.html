<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spudy News Premium - Daily Updates</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <style>
        :root {
            --bg-color: #071429;
            --text-color: #ffffff;
            --card-bg: rgba(255, 255, 255, 0.15);
            --modal-bg: rgba(255, 255, 255, 0.2);
            --input-bg: rgba(255, 255, 255, 0.25);
            --accent-color: #00c6ff;
            --navbar-bg: rgba(0, 51, 102, 0.4);
        }

        [data-theme="light"] {
            --bg-color: #f5f5f5;
            --text-color: #071429;
            --card-bg: rgba(0, 0, 0, 0.1);
            --modal-bg: rgba(255, 255, 255, 0.9);
            --input-bg: rgba(0, 0, 0, 0.1);
            --accent-color: #007bff;
            --navbar-bg: rgba(255, 255, 255, 0.9);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            color: var(--text-color);
            background: var(--bg-color);
            overflow-x: hidden;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px var(--accent-color); }
            50% { box-shadow: 0 0 20px var(--accent-color); }
            100% { box-shadow: 0 0 5px var(--accent-color); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 15px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--navbar-bg);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            z-index: 1000;
            animation: fadeInUp 1s ease;
        }

        .navbar .logo {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: var(--text-color);
        }

        .navbar .premium-badge {
            font-size: 0.8rem;
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            color: #071429;
            padding: 5px 10px;
            border-radius: 15px;
            margin-left: 10px;
        }

        .nav-card {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .navbar .menu-toggle {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.5rem;
            cursor: pointer;
            display: none;
        }

        .navbar .menu-toggle:hover, .navbar .menu-toggle:focus {
            color: var(--accent-color);
        }

        .navbar .nav-links {
            display: flex;
            gap: 25px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .navbar .nav-links.active {
            opacity: 1;
            pointer-events: auto;
            animation: fadeIn 0.5s ease;
        }

        .navbar .nav-links a {
            color: var(--text-color);
            text-decoration: none;
            font-size: 1rem;
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 25px;
            transition: background 0.4s, color 0.4s, transform 0.4s;
        }

        .navbar .nav-links a:hover, .navbar .nav-links a:focus {
            background: rgba(0, 123, 255, 0.4);
            color: var(--accent-color);
            transform: scale(1.05);
        }

        .navbar .account-btn {
            padding: 12px 25px;
            background: linear-gradient(45deg, #003087, #007bff);
            color: #ffffff;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.4s, box-shadow 0.4s;
        }

        .navbar .account-btn:hover, .navbar .account-btn:focus {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.5);
            background: linear-gradient(45deg, #007bff, var(--accent-color));
        }

        .navbar .account-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--modal-bg);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 123, 255, 0.3);
            border-radius: 15px;
            padding: 15px 0;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.5);
            min-width: 160px;
            margin-top: 10px;
        }

        .navbar .account-btn.active + .account-dropdown {
            display: block;
            animation: slideIn 0.4s ease-in;
        }

        .navbar .account-dropdown a {
            display: block;
            padding: 12px 25px;
            color: var(--text-color);
            text-decoration: none;
            font-size: 0.9rem;
            transition: background 0.4s, transform 0.4s;
        }

        .navbar .account-dropdown a:hover, .navbar .account-dropdown a:focus {
            background: rgba(0, 123, 255, 0.4);
            color: var(--accent-color);
            transform: translateX(6px);
        }

        .navbar .user-indicator {
            padding: 12px 25px;
            background: linear-gradient(45deg, #003087, #007bff);
            color: #ffffff;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.4s, box-shadow 0.4s;
        }

        .navbar .user-indicator:hover, .navbar .user-indicator:focus {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.5);
        }

        .navbar .settings-btn {
            padding: 12px 25px;
            background: linear-gradient(45deg, #003087, #007bff);
            color: #ffffff;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.4s, box-shadow 0.4s;
        }

        .navbar .settings-btn:hover, .navbar .settings-btn:focus {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.5);
            background: linear-gradient(45deg, #007bff, var(--accent-color));
        }

        .navbar .settings-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--modal-bg);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 123, 255, 0.3);
            border-radius: 15px;
            padding: 15px 0;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.5);
            min-width: 180px;
            margin-top: 10px;
        }

        .navbar .settings-btn.active + .settings-dropdown {
            display: block;
            animation: slideIn 0.4s ease-in;
        }

        .navbar .settings-dropdown a {
            display: block;
            padding: 12px 25px;
            color: var(--text-color);
            text-decoration: none;
            font-size: 0.9rem;
            transition: background 0.4s, transform 0.4s;
        }

        .navbar .settings-dropdown a:hover, .navbar .settings-dropdown a:focus {
            background: rgba(0, 123, 255, 0.4);
            color: var(--accent-color);
            transform: translateX(6px);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1003;
            justify-content: center;
            align-items: center;
            pointer-events: auto;
            transition: opacity 0.5s ease;
        }

        .modal-content {
            background: var(--modal-bg);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 25px;
            border: 1px solid rgba(0, 123, 255, 0.25);
            width: 90%;
            max-width: 450px;
            text-align: center;
            animation: fadeInUp 0.6s ease;
            box-shadow: 0 12px 35px rgba(0, 123, 255, 0.4);
        }

        .modal-content h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-color);
        }

        .modal-content .form-card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid rgba(0, 123, 255, 0.25);
            margin-bottom: 20px;
            animation: fadeInUp 0.8s ease;
        }

        .modal-content input {
            width: 100%;
            padding: 14px 45px 14px 20px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            background: var(--input-bg);
            color: var(--text-color);
            transition: box-shadow 0.4s, border 0.4s;
        }

        .modal-content input:focus {
            box-shadow: 0 0 12px rgba(0, 123, 255, 0.6);
            border: 1px solid var(--accent-color);
            outline: none;
        }

        .modal-content input.valid {
            border: 1px solid #00ff00;
            box-shadow: 0 0 12px rgba(0, 255, 0, 0.6);
        }

        .modal-content input.invalid {
            border: 1px solid #ff4d4d;
            box-shadow: 0 0 12px rgba(255, 77, 77, 0.6);
        }

        .modal-content .input-group {
            position: relative;
            margin: 12px 0;
        }

        .modal-content .input-group i {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent-color);
            font-size: 1rem;
        }

        .modal-content button {
            padding: 14px 35px;
            background: linear-gradient(45deg, #007bff, var(--accent-color));
            color: #ffffff;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.4s, box-shadow 0.4s;
        }

        .modal-content button:hover, .modal-content button:focus {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.5);
            animation: glow 1.5s infinite;
        }

        .modal-content .close {
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .modal-content .close:hover, .modal-content .close:focus {
            color: var(--accent-color);
        }

        .modal-content .error {
            color: #ff4d4d;
            font-size: 0.9rem;
            margin-top: 12px;
        }

        .modal-content .switch-btn {
            display: inline-block;
            margin-top: 12px;
            padding: 10px 25px;
            background: linear-gradient(45deg, #007bff, var(--accent-color));
            color: #ffffff;
            text-decoration: none;
            border-radius: 50px;
            font-size: 1rem;
            transition: transform 0.4s, box-shadow 0.4s;
        }

        .modal-content .switch-btn:hover, .modal-content .switch-btn:focus {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.5);
        }

        .modal-content .login-notice {
            display: none;
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 123, 255, 0.3);
            border-radius: 12px;
            padding: 12px;
            margin-top: 12px;
            font-size: 0.9rem;
            color: #ff4d4d;
            animation: slideIn 0.4s ease-in;
        }

        .modal-content .login-notice.active {
            display: block;
        }

        .modal-content .password-suggestion {
            font-size: 0.9rem;
            color: var(--accent-color);
            margin-top: 8px;
            word-break: break-all;
        }

        .modal-content .generate-password {
            padding: 10px 20px;
            background: linear-gradient(45deg, #003087, #007bff);
            color: #ffffff;
            border: none;
            border-radius: 50px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-left: 12px;
            transition: transform 0.4s, box-shadow 0.4s;
        }

        .modal-content .generate-password:hover, .modal-content .generate-password:focus {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.5);
        }

        .hero {
            position: relative;
            height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            overflow: hidden;
            background: url('https://images.unsplash.com/photo-1518709268805-4e9042af592e?q=80&w=2070&auto=format&fit=crop') no-repeat center center/cover;
            z-index: 1;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(7, 20, 41, 0.75);
            z-index: 2;
        }

        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 3;
        }

        .hero-content {
            z-index: 4;
            animation: fadeInUp 1.3s ease;
        }

        .hero-content h1 {
            font-family: 'Playfair Display', serif;
            font-size: 4.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-color);
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .hero-content .typing {
            font-size: 2rem;
            margin-bottom: 2.5rem;
            color: var(--accent-color);
            height: 2.5rem;
            font-weight: 500;
        }

        .cta-button {
            padding: 1.3rem 4rem;
            background: linear-gradient(45deg, #007bff, var(--accent-color));
            color: #ffffff;
            text-decoration: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 500;
            transition: transform 0.4s, box-shadow 0.4s;
            z-index: 5;
        }

        .cta-button:hover, .cta-button:focus {
            transform: translateY(-6px);
            box-shadow: 0 10px 25px rgba(0, 123, 255, 0.7);
            animation: glow 1.5s infinite;
        }

        .container {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
            margin-top: 20px;
            animation: fadeInUp 1.2s ease;
            z-index: 1;
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .news-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            animation: fadeInUp 1.2s ease;
            transition: transform 0.4s, box-shadow 0.4s;
        }

        .news-card:hover, .news-card:focus {
            transform: translateY(-6px);
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.4);
        }

        .news-card .title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .read-now-btn {
            padding: 12px 25px;
            background: linear-gradient(45deg, #007bff, var(--accent-color));
            color: #ffffff;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.4s, box-shadow 0.4s;
            width: 100%;
        }

        .read-now-btn:hover, .read-now-btn:focus {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.5);
            animation: glow 1.5s infinite;
        }

        .news-section {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            justify-content: center;
            align-items: center;
            z-index: 1001;
            transition: opacity 0.5s ease;
        }

        .news-viewer {
            max-width: 900px;
            width: 95%;
            background: var(--modal-bg);
            padding: 30px;
            border-radius: 12px;
            animation: fadeInUp 0.6s ease;
            overflow-y: auto;
            max-height: 85vh;
            box-shadow: 0 12px 35px rgba(0, 123, 255, 0.4);
        }

        .news-viewer .close-news {
            position: absolute;
            top: 25px;
            right: 25px;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .news-viewer .close-news:hover, .news-viewer .close-news:focus {
            color: var(--accent-color);
        }

        .news-viewer .news-title {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 1.2rem;
            color: var(--text-color);
        }

        .news-viewer .news-meta {
            font-size: 1rem;
            color: var(--accent-color);
            margin-bottom: 1.2rem;
            font-weight: 500;
        }

        .news-viewer .news-content {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 1.5rem;
            color: var(--text-color);
        }

        .news-viewer .comments-section {
            margin-top: 25px;
            max-height: 250px;
            overflow-y: auto;
        }

        .news-viewer .comments-section input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 50px;
            background: var(--input-bg);
            color: var(--text-color);
            font-size: 1rem;
        }

        .news-viewer .comments-section button {
            padding: 12px 25px;
            background: linear-gradient(45deg, #007bff, var(--accent-color));
            color: #ffffff;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 12px;
            font-size: 1rem;
            transition: transform 0.4s, box-shadow 0.4s;
        }

        .news-viewer .comments-section button:hover, .news-viewer .comments-section button:focus {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.5);
        }

        .news-viewer .comments-section .comment {
            padding: 12px;
            background: var(--card-bg);
            border-radius: 10px;
            margin: 12px 0;
            font-size: 0.9rem;
        }

        .inaccessible {
            pointer-events: none;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 15px 25px;
            }

            .navbar .menu-toggle {
                display: block;
            }

            .navbar .nav-links {
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background: var(--navbar-bg);
                backdrop-filter: blur(15px);
                flex-direction: column;
                padding: 25px;
                display: none;
            }

            .navbar .nav-links.active {
                display: flex;
            }

            .container {
                padding: 15px;
            }

            .hero-content h1 {
                font-size: 3rem;
            }

            .hero-content .typing {
                font-size: 1.5rem;
            }

            .news-card .title {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="navbar" role="navigation" aria-label="Main navigation">
        <div class="logo">Spudy News <span class="premium-badge">Premium</span></div>
        <div class="nav-card">
            <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu"><i class="fas fa-bars"></i></button>
            <div class="nav-links" id="navLinks">
                <a href="#" onclick="checkAuth(() => filterCategory('all'))" aria-label="Home">Home</a>
                <a href="#" onclick="checkAuth(showSubscriptions)" aria-label="Subscriptions">Subscriptions</a>
            </div>
            <input type="text" placeholder="Search news..." id="searchBar" aria-label="Search news" style="border: none; border-radius: 50px; padding: 8px; background: var(--input-bg); color: var(--text-color);">
            <select id="categoryFilter" aria-label="Filter by category" style="border: none; border-radius: 50px; padding: 8px; background: var(--input-bg); color: var(--text-color);">
                <option value="all">All</option>
                <option value="politics">Politics</option>
                <option value="technology">Technology</option>
                <option value="sports">Sports</option>
                <option value="entertainment">Entertainment</option>
            </select>
            <button class="account-btn" id="accountBtn" aria-label="Account options"><i class="fas fa-user"></i> Account</button>
            <div class="account-dropdown" id="accountDropdown">
                <a href="#" id="loginLink" onclick="showModal('login')" aria-label="Login">Login</a>
                <a href="#" id="signupLink" onclick="showModal('signup')" aria-label="Sign Up">Sign Up</a>
            </div>
            <div class="user-indicator" id="userIndicator" style="display: none;" aria-label="Logged in user">
                <i class="fas fa-user"></i> Logged in as <span id="loggedInUsername"></span>
            </div>
            <button class="settings-btn" id="settingsBtn" style="display: none;" aria-label="Settings"><i class="fas fa-cog"></i> Settings</button>
            <div class="settings-dropdown" id="settingsDropdown">
                <a href="#" onclick="showModal('changePassword')" aria-label="Change Password">Change Password</a>
                <a href="#" onclick="showModal('theme')" aria-label="Change Theme">Theme</a>
                <a href="#" onclick="showModal('accountInfo')" aria-label="Account Info">Account Info</a>
                <a href="#" onclick="logout()" aria-label="Logout">Logout</a>
            </div>
        </div>
    </div>

    <div class="hero" id="hero">
        <div id="particles-js"></div>
        <div class="hero-content">
            <h1>Welcome to Spudy News Premium</h1>
            <div class="typing">Your Exclusive News Source</div>
            <a href="#content" class="cta-button" onclick="checkAuth(() => scrollToContent())" aria-label="Discover news">Discover Now</a>
        </div>
    </div>

    <div class="container" id="content">
        <div class="gallery" id="gallery"></div>
    </div>

    <div class="news-section" id="newsSection" role="dialog" aria-modal="true" aria-label="News article viewer">
        <span class="close-news" onclick="closeNews()" tabindex="0" aria-label="Close news viewer">Ã—</span>
        <div class="news-viewer" id="newsViewer">
            <div class="comments-section" id="commentsSection"></div>
        </div>
    </div>

    <div class="modal" id="loginModal" role="dialog" aria-modal="true" aria-label="Login modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('login')" tabindex="0" aria-label="Close login modal">Ã—</span>
            <h2>Login to Spudy News Premium</h2>
            <div class="form-card">
                <div class="input-group">
                    <input type="text" id="loginUsername" placeholder="Username" oninput="validateInput(this)" aria-label="Username">
                    <i class="fas fa-user"></i>
                </div>
                <div class="input-group">
                    <input type="password" id="loginPassword" placeholder="Password" oninput="validateInput(this)" aria-label="Password">
                    <i class="fas fa-lock"></i>
                </div>
                <button onclick="login()" aria-label="Login">Login</button>
                <div class="login-notice" id="loginNotice">New users must register first.</div>
            </div>
            <a href="#" class="switch-btn" onclick="switchModal('signup')" aria-label="Switch to register">Switch to Register</a>
            <div class="error" id="loginError"></div>
        </div>
    </div>
    <div class="modal" id="signupModal" role="dialog" aria-modal="true" aria-label="Sign up modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('signup')" tabindex="0" aria-label="Close sign up modal">Ã—</span>
            <h2>Join Spudy News Premium</h2>
            <div class="form-card">
                <div class="input-group">
                    <input type="text" id="signupUsername" placeholder="Username" oninput="validateInput(this)" aria-label="Username">
                    <i class="fas fa-user"></i>
                </div>
                <div class="input-group">
                    <input type="email" id="signupEmail" placeholder="Email" oninput="validateInput(this)" aria-label="Email">
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="input-group">
                    <input type="password" id="signupPassword" placeholder="Password" oninput="validateInput(this)" aria-label="Password">
                    <i class="fas fa-lock"></i>
                    <button class="generate-password" onclick="generatePassword()" aria-label="Generate password">Generate</button>
                </div>
                <div class="password-suggestion" id="passwordSuggestion"></div>
                <button onclick="signup()" aria-label="Sign up">Sign Up</button>
            </div>
            <a href="#" class="switch-btn" onclick="switchModal('login')" aria-label="Switch to login">Switch to Login</a>
            <div class="error" id="signupError"></div>
        </div>
    </div>
    <div class="modal" id="changePasswordModal" role="dialog" aria-modal="true" aria-label="Change password modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('changePassword')" tabindex="0" aria-label="Close change password modal">Ã—</span>
            <h2>Change Password</h2>
            <div class="form-card">
                <div class="input-group">
                    <input type="password" id="currentPassword" placeholder="Current Password" oninput="validateInput(this)" aria-label="Current password">
                    <i class="fas fa-lock"></i>
                </div>
                <div class="input-group">
                    <input type="password" id="newPassword" placeholder="New Password" oninput="validateInput(this)" aria-label="New password">
                    <i class="fas fa-lock"></i>
                </div>
                <button onclick="changePassword()" aria-label="Update password">Update Password</button>
            </div>
            <div class="error" id="changePasswordError"></div>
        </div>
    </div>
    <div class="modal" id="themeModal" role="dialog" aria-modal="true" aria-label="Theme selection modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('theme')" tabindex="0" aria-label="Close theme modal">Ã—</span>
            <h2>Choose Theme</h2>
            <div class="form-card">
                <button onclick="setTheme('dark')" aria-label="Select dark theme">Dark Theme</button>
                <button onclick="setTheme('light')" aria-label="Select light theme">Light Theme</button>
            </div>
        </div>
    </div>
    <div class="modal" id="accountInfoModal" role="dialog" aria-modal="true" aria-label="Account information modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('accountInfo')" tabindex="0" aria-label="Close account info modal">Ã—</span>
            <h2>Account Information</h2>
            <div class="form-card">
                <p><strong>Username:</strong> <span id="accountUsername"></span></p>
                <p><strong>Email:</strong> <span id="accountEmail"></span></p>
            </div>
        </div>
    </div>

    <script>
        let db;
        const request = indexedDB.open('SpudyNewsDB', 2);

        request.onupgradeneeded = function(event) {
            db = event.target.result;
            if (!db.objectStoreNames.contains('news')) {
                db.createObjectStore('news', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('users')) {
                db.createObjectStore('users', { keyPath: 'username' });
            }
            if (!db.objectStoreNames.contains('comments')) {
                db.createObjectStore('comments', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('likes')) {
                db.createObjectStore('likes', { keyPath: 'id', autoIncrement: true });
            }
            if (!db.objectStoreNames.contains('subscriptions')) {
                db.createObjectStore('subscriptions', { keyPath: 'id', autoIncrement: true });
            }
        };

        request.onsuccess = function(event) {
            db = event.target.result;
            preloadNews();
            checkCurrentUser();
            loadTheme();
        };

        request.onerror = function(event) {
            console.error('IndexedDB error:', event.target.errorCode);
            alert('Failed to initialize database. Please try again.');
        };

        function preloadNews() {
            const transaction = db.transaction(['news'], 'readwrite');
            const store = transaction.objectStore('news');
            const request = store.getAll();
            request.onsuccess = function(event) {
                if (event.target.result.length === 0) {
                    const newsData = {
                        title: 'ðŸŽ¤ BREAKING MUSIC NEWS: A SONG THAT WILL STIR YOUR SOUL!',
                        content: `ðŸ”¥ EXCLUSIVE from Spudy TV ðŸ”¥

ðŸŽµ ARTIST: Spudy
ðŸŽ¶ SONG TITLE: Mai Vangu
ðŸ“† RELEASE DATE: Next week, Monday
ðŸŽ¥ OFFICIAL MUSIC VIDEO: Drops SAME DAY

Youâ€™ve heard musicâ€¦ but you havenâ€™t felt music like this before.
Spudy is back â€” not just with a song, but with a deeply personal anthem that will move your heart and stay with you long after it ends.

ðŸŒº Mai Vangu is not just a melody â€” itâ€™s a story. A tribute. A celebration of love, sacrifice, and strength. Inspired by the unshakable spirit of a mother, this song reaches into the most sacred places of our lives â€” the people who raised us, believed in us, and stood by us through everything.

ðŸ’” Have you ever wanted to say thank you but didnâ€™t know how?
ðŸŒ Have you ever longed to give your mother her flowers while she can still smell them?

This is your song. This is our story.

From the very first note of Mai Vangu, youâ€™ll feel it â€” the warmth of home, the ache of memories, the pride in our roots. Spudy delivers vocals that cut deep, lyrics that speak loud, and emotion that canâ€™t be faked.

And just when you think it couldnâ€™t hit harder â€” ðŸŽ¬ the official music video drops alongside the track, bringing the songâ€™s message to life in stunning visuals that will leave you breathless.

ðŸš¨ Set your alarms. Tell your friends. Prepare your heart.
Because this Monday, a cultural moment is coming.

ðŸ‘‰ Follow Spudy TV for countdowns, sneak peeks, and exclusive behind-the-scenes content.

ðŸŽ§ Mai Vangu isnâ€™t just another release â€”
Itâ€™s the sound of gratitude.
Itâ€™s the voice of our mothers.
Itâ€™s the anthem we didnâ€™t know we neededâ€¦ until now.`,
                        category: 'entertainment',
                        author: 'Spudy TV',
                        date: new Date().toISOString()
                    };
                    store.add(newsData).onsuccess = function() {
                        renderGallery();
                    };
                }
            };
        }

        particlesJS('particles-js', {
            particles: {
                number: { value: 100, density: { enable: true, value_area: 800 } },
                color: { value: '#00c6ff' },
                shape: { type: 'circle' },
                opacity: { value: 0.6, random: true },
                size: { value: 4, random: true },
                line_linked: { enable: true, distance: 150, color: '#00c6ff', opacity: 0.5, width: 1.2 },
                move: { enable: true, speed: 8, direction: 'none', random: false }
            },
            interactivity: {
                detect_on: 'canvas',
                events: { onhover: { enable: true, mode: 'repulse' }, onclick: { enable: true, mode: 'push' } },
                modes: { repulse: { distance: 120 }, push: { particles_nb: 5 } }
            }
        });

        let currentUser = null;

        function loadTheme() {
            const theme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', theme);
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            closeModal('theme');
        }

        function checkCurrentUser() {
            const username = localStorage.getItem('currentUser');
            if (username) {
                const transaction = db.transaction(['users'], 'readonly');
                const store = transaction.objectStore('users');
                const request = store.get(username);
                request.onsuccess = function(event) {
                    currentUser = event.target.result;
                    if (currentUser) {
                        updateLoggedInUI(currentUser.username);
                        document.body.classList.remove('inaccessible');
                        document.getElementById('hero').classList.remove('inaccessible');
                        document.getElementById('content').style.display = 'block';
                        document.getElementById('navLinks').style.display = 'flex';
                        renderGallery();
                        scrollToContent();
                    } else {
                        localStorage.removeItem('currentUser');
                        showModal('signup');
                        lockPage();
                    }
                };
                request.onerror = function(event) {
                    console.error('Error fetching user:', event.target.error);
                    showModal('signup');
                    lockPage();
                };
            } else {
                showModal('signup');
                lockPage();
            }
        }

        function lockPage() {
            document.body.classList.add('inaccessible');
            document.getElementById('hero').classList.add('inaccessible');
            document.getElementById('content').style.display = 'none';
            document.getElementById('navLinks').style.display = 'none';
            document.getElementById('gallery').innerHTML = '';
            document.getElementById('accountBtn').style.display = 'block';
            document.getElementById('accountDropdown').style.display = 'none';
            document.getElementById('loginLink').style.display = 'none';
            document.getElementById('signupLink').style.display = 'block';
            document.getElementById('userIndicator').style.display = 'none';
            document.getElementById('settingsBtn').style.display = 'none';
        }

        function updateLoggedInUI(username) {
            document.getElementById('accountBtn').style.display = 'none';
            document.getElementById('accountDropdown').style.display = 'none';
            document.getElementById('userIndicator').style.display = 'flex';
            document.getElementById('loggedInUsername').textContent = username;
            document.getElementById('settingsBtn').style.display = 'flex';
        }

        function validateInput(input) {
            if (input.type === 'email') {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (emailRegex.test(input.value.trim())) {
                    input.classList.add('valid');
                    input.classList.remove('invalid');
                } else {
                    input.classList.add('invalid');
                    input.classList.remove('valid');
                }
            } else if (input.value.trim()) {
                input.classList.add('valid');
                input.classList.remove('invalid');
            } else {
                input.classList.add('invalid');
                input.classList.remove('valid');
            }
        }

        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            const error = document.getElementById('loginError');
            const notice = document.getElementById('loginNotice');
            notice.classList.remove('active');
            if (!username || !password) {
                error.textContent = 'Please fill in all fields';
                return;
            }
            const transaction = db.transaction(['users'], 'readonly');
            const store = transaction.objectStore('users');
            const request = store.get(username);
            request.onsuccess = function(event) {
                const user = event.target.result;
                if (!user) {
                    notice.classList.add('active');
                    error.textContent = '';
                    return;
                }
                if (user.password === password) {
                    currentUser = user;
                    localStorage.setItem('currentUser', username);
                    updateLoggedInUI(username);
                    closeModal('login');
                    document.body.classList.remove('inaccessible');
                    document.getElementById('hero').classList.remove('inaccessible');
                    document.getElementById('content').style.display = 'block';
                    document.getElementById('navLinks').style.display = 'flex';
                    renderGallery();
                    scrollToContent();
                } else {
                    error.textContent = 'Invalid password';
                }
            };
            request.onerror = function(event) {
                console.error('Login error:', event.target.error);
                error.textContent = 'Error logging in. Please try again.';
            };
        }

        function signup() {
            const username = document.getElementById('signupUsername').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const error = document.getElementById('signupError');
            if (!username || !email || !password) {
                error.textContent = 'Please fill in all fields';
                return;
            }
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                error.textContent = 'Please enter a valid email address';
                return;
            }
            const passwordValid = password.length >= 8 && /[A-Z]/.test(password) && /[a-z]/.test(password) && /[0-9]/.test(password) && /[!@#$%^&*]/.test(password);
            if (!passwordValid) {
                error.textContent = 'Password must be at least 8 characters with uppercase, lowercase, number, and special character';
                return;
            }
            const transaction = db.transaction(['users'], 'readwrite');
            const store = transaction.objectStore('users');
            const request = store.get(username);
            request.onsuccess = function(event) {
                if (event.target.result) {
                    error.textContent = 'Username already exists';
                } else {
                    const addRequest = store.add({ username, email, password });
                    addRequest.onsuccess = function() {
                        currentUser = { username, email, password };
                        localStorage.setItem('currentUser', username);
                        updateLoggedInUI(username);
                        closeModal('signup');
                        document.body.classList.remove('inaccessible');
                        document.getElementById('hero').classList.remove('inaccessible');
                        document.getElementById('content').style.display = 'block';
                        document.getElementById('navLinks').style.display = 'flex';
                        renderGallery();
                        scrollToContent();
                    };
                    addRequest.onerror = function(event) {
                        console.error('Signup error:', event.target.error);
                        error.textContent = 'Error signing up. Please try again.';
                    };
                }
            };
            request.onerror = function(event) {
                console.error('Signup check error:', event.target.error);
                error.textContent = 'Error checking username. Please try again.';
            };
        }

        function generatePassword() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
            let password = '';
            for (let i = 0; i < 12; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            while (!(password.length >= 8 && /[A-Z]/.test(password) && /[a-z]/.test(password) && /[0-9]/.test(password) && /[!@#$%^&*]/.test(password))) {
                password = '';
                for (let i = 0; i < 12; i++) {
                    password += chars.charAt(Math.floor(Math.random() * chars.length));
                }
            }
            document.getElementById('signupPassword').value = password;
            document.getElementById('passwordSuggestion').textContent = `Suggested: ${password}`;
            validateInput(document.getElementById('signupPassword'));
        }

        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const error = document.getElementById('changePasswordError');
            if (!currentPassword || !newPassword) {
                error.textContent = 'Please fill in all fields';
                return;
            }
            if (currentPassword !== currentUser.password) {
                error.textContent = 'Current password is incorrect';
                return;
            }
            const passwordValid = newPassword.length >= 8 && /[A-Z]/.test(newPassword) && /[a-z]/.test(newPassword) && /[0-9]/.test(newPassword) && /[!@#$%^&*]/.test(newPassword);
            if (!passwordValid) {
                error.textContent = 'New password must be at least 8 characters with uppercase, lowercase, number, and special character';
                return;
            }
            const transaction = db.transaction(['users'], 'readwrite');
            const store = transaction.objectStore('users');
            const request = store.put({ username: currentUser.username, email: currentUser.email, password: newPassword });
            request.onsuccess = function() {
                currentUser.password = newPassword;
                closeModal('changePassword');
                alert('Password updated successfully!');
            };
            request.onerror = function(event) {
                console.error('Change password error:', event.target.error);
                error.textContent = 'Error updating password. Please try again.';
            };
        }

        function showAccountInfo() {
            if (!currentUser) {
                showModal('signup');
                return;
            }
            document.getElementById('accountUsername').textContent = currentUser.username;
            document.getElementById('accountEmail').textContent = currentUser.email || 'Not provided';
            showModal('accountInfo');
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showModal('signup');
            lockPage();
        }

        function checkAuth(callback) {
            if (currentUser) {
                callback();
            } else {
                showModal('signup');
            }
        }

        function scrollToContent() {
            document.getElementById('content').scrollIntoView({ behavior: 'smooth' });
        }

        function showModal(type) {
            const modal = document.getElementById(`${type}Modal`);
            modal.style.display = 'flex';
            modal.querySelector('input')?.focus();
        }

        function closeModal(type) {
            const modal = document.getElementById(`${type}Modal`);
            modal.style.display = 'none';
            document.getElementById(`${type}Error`).textContent = '';
            const inputs = modal.querySelectorAll('input');
            inputs.forEach(input => {
                input.value = '';
                input.classList.remove('valid', 'invalid');
            });
            document.getElementById('passwordSuggestion').textContent = '';
            document.getElementById('loginNotice')?.classList.remove('active');
        }

        function switchModal(type) {
            closeModal(type === 'login' ? 'signup' : 'login');
            showModal(type);
        }

        document.getElementById('menuToggle').addEventListener('click', function() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        });

        document.getElementById('menuToggle').addEventListener('keydown', function(event) {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                this.click();
            }
        });

        document.getElementById('accountBtn').addEventListener('click', function() {
            const dropdown = document.getElementById('accountDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
            this.classList.toggle('active');
        });

        document.getElementById('accountBtn').addEventListener('keydown', function(event) {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                this.click();
            }
        });

        document.getElementById('settingsBtn').addEventListener('click', function() {
            const dropdown = document.getElementById('settingsDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
            this.classList.toggle('active');
        });

        document.getElementById('settingsBtn').addEventListener('keydown', function(event) {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                this.click();
            }
        });

        function renderGallery(filter = 'all', query = '') {
            if (!currentUser) {
                showModal('signup');
                return;
            }
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            const transaction = db.transaction(['news'], 'readonly');
            const store = transaction.objectStore('news');
            const request = store.getAll();
            request.onsuccess = function(event) {
                let newsList = event.target.result;
                if (filter !== 'all') {
                    newsList = newsList.filter(news => news.category === filter);
                }
                if (query) {
                    newsList = newsList.filter(news => news.title.toLowerCase().includes(query.toLowerCase()));
                }
                newsList.forEach(news => {
                    const card = document.createElement('div');
                    card.className = 'news-card';
                    card.tabIndex = 0;
                    card.innerHTML = `
                        <div class="title" aria-label="News headline: ${news.title}">${news.title}</div>
                        <button class="read-now-btn" onclick="readNews(${news.id}, this)" aria-label="Read news: ${news.title}">Read Now</button>
                    `;
                    card.addEventListener('keydown', function(event) {
                        if (event.key === 'Enter' || event.key === ' ') {
                            event.preventDefault();
                            readNews(news.id, card.querySelector('.read-now-btn'));
                        }
                    });
                    gallery.appendChild(card);
                });
            };
            request.onerror = function(event) {
                console.error('Error fetching news:', event.target.error);
                alert('Failed to load news. Please try again.');
            };
        }

        function readNews(id, button) {
            if (!currentUser) {
                showModal('signup');
                return;
            }
            const transaction = db.transaction(['news'], 'readonly');
            const store = transaction.objectStore('news');
            const request = store.get(id);
            request.onsuccess = function(event) {
                const news = event.target.result;
                if (!news) {
                    console.error('News not found for ID:', id);
                    alert('News article not found. Please try again.');
                    return;
                }
                const newsSection = document.getElementById('newsSection');
                const newsViewer = document.getElementById('newsViewer');
                newsViewer.innerHTML = `
                    <h2 class="news-title">${news.title}</h2>
                    <div class="news-meta">By ${news.author} | ${new Date(news.date).toLocaleDateString()}</div>
                    <div class="news-content">${news.content}</div>
                `;
                renderComments(id);
                newsSection.style.display = 'flex';
                newsViewer.focus();
            };
            request.onerror = function(event) {
                console.error('Error fetching news article:', event.target.error);
                alert('Failed to load news article. Please try again.');
            };
        }

        function closeNews() {
            const newsSection = document.getElementById('newsSection');
            const newsViewer = document.getElementById('newsViewer');
            newsViewer.innerHTML = '';
            newsSection.style.display = 'none';
        }

        document.querySelector('.close-news').addEventListener('keydown', function(event) {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                closeNews();
            }
        });

        function renderComments(newsId) {
            const commentsSection = document.getElementById('commentsSection');
            commentsSection.innerHTML = `
                <input type="text" id="commentInput" placeholder="Add a comment..." aria-label="Add a comment">
                <button onclick="addComment(${newsId})" aria-label="Post comment">Post</button>
            `;
            const transaction = db.transaction(['comments'], 'readonly');
            const store = transaction.objectStore('comments');
            const request = store.getAll();
            request.onsuccess = function(event) {
                const comments = event.target.result.filter(comment => comment.newsId === newsId);
                comments.forEach(comment => {
                    const div = document.createElement('div');
                    div.className = 'comment';
                    div.innerHTML = `<p><strong>${comment.user}</strong>: ${comment.text}</p>`;
                    commentsSection.appendChild(div);
                });
            };
        }

        function addComment(newsId) {
            if (!currentUser) {
                showModal('signup');
                return;
            }
            const text = document.getElementById('commentInput').value.trim();
            if (!text) return;
            const transaction = db.transaction(['comments'], 'readwrite');
            const store = transaction.objectStore('comments');
            store.add({ newsId, user: currentUser.username, text });
            transaction.oncomplete = function() {
                renderComments(newsId);
                document.getElementById('commentInput').value = '';
            };
        }

        function toggleLike(newsId, button) {
            if (!currentUser) {
                showModal('signup');
                return;
            }
            const transaction = db.transaction(['likes'], 'readwrite');
            const store = transaction.objectStore('likes');
            const request = store.getAll();
            request.onsuccess = function(event) {
                const isLiked = event.target.result.some(like => like.newsId === newsId && like.user === currentUser.username);
                if (isLiked) {
                    const deleteTransaction = db.transaction(['likes'], 'readwrite');
                    const deleteStore = deleteTransaction.objectStore('likes');
                    deleteStore.delete(event.target.result.find(like => like.newsId === newsId && like.user === currentUser.username).id);
                    deleteTransaction.oncomplete = function() {
                        renderGallery();
                    };
                } else {
                    store.add({ newsId, user: currentUser.username });
                    transaction.oncomplete = function() {
                        renderGallery();
                    };
                }
            };
        }

        function toggleSubscribe(newsId, button) {
            if (!currentUser) {
                showModal('signup');
                return;
            }
            const transaction = db.transaction(['subscriptions'], 'readwrite');
            const store = transaction.objectStore('subscriptions');
            const request = store.getAll();
            request.onsuccess = function(event) {
                const isSubscribed = event.target.result.some(sub => sub.newsId === newsId && sub.user === currentUser.username);
                if (isSubscribed) {
                    const deleteTransaction = db.transaction(['subscriptions'], 'readwrite');
                    const deleteStore = deleteTransaction.objectStore('subscriptions');
                    deleteStore.delete(event.target.result.find(sub => sub.newsId === newsId && sub.user === currentUser.username).id);
                    deleteTransaction.oncomplete = function() {
                        renderGallery();
                    };
                } else {
                    store.add({ newsId, user: currentUser.username });
                    transaction.oncomplete = function() {
                        renderGallery();
                    };
                }
            };
        }

        function showSubscriptions() {
            if (!currentUser) {
                showModal('signup');
                return;
            }
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            const transaction = db.transaction(['subscriptions'], 'readonly');
            const store = transaction.objectStore('subscriptions');
            const request = store.getAll();
            request.onsuccess = function(event) {
                const subs = event.target.result.filter(sub => sub.user === currentUser.username);
                const newsTransaction = db.transaction(['news'], 'readonly');
                const newsStore = newsTransaction.objectStore('news');
                const newsRequest = newsStore.getAll();
                newsRequest.onsuccess = function(event) {
                    const newsList = event.target.result.filter(news => subs.some(sub => sub.newsId === news.id));
                    newsList.forEach(news => {
                        const card = document.createElement('div');
                        card.className = 'news-card';
                        card.tabIndex = 0;
                        card.innerHTML = `
                            <div class="title" aria-label="News headline: ${news.title}">${news.title}</div>
                            <button class="read-now-btn" onclick="readNews(${news.id}, this)" aria-label="Read news: ${news.title}">Read Now</button>
                        `;
                        card.addEventListener('keydown', function(event) {
                            if (event.key === 'Enter' || event.key === ' ') {
                                event.preventDefault();
                                readNews(news.id, card.querySelector('.read-now-btn'));
                            }
                        });
                        gallery.appendChild(card);
                    });
                };
            };
        }

        document.getElementById('searchBar').addEventListener('input', function(e) {
            renderGallery(document.getElementById('categoryFilter').value, e.target.value);
        });

        document.getElementById('categoryFilter').addEventListener('change', function(e) {
            renderGallery(e.target.value, document.getElementById('searchBar').value);
        });

        function filterCategory(category) {
            document.getElementById('categoryFilter').value = category;
            renderGallery(category, document.getElementById('searchBar').value);
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (modal.style.display === 'flex') {
                        closeModal(modal.id.replace('Modal', ''));
                    }
                });
                if (document.getElementById('newsSection').style.display === 'flex') {
                    closeNews();
                }
            }
        });

        renderGallery();
    </script>
</body>
</html>
